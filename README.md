# AMO CRM API Клиент

Программа для работы с API AMO CRM, написанная на Python. Позволяет экспортировать контакты в CSV-файл и обновлять их из CSV-файла.

## Возможности

1. Экспорт списка контактов из AMO CRM в CSV файл
2. Обновление имени и фамилии контактов в AMO CRM из CSV файла

## Установка

1. Клонировать репозиторий:
```
git clone https://github.com/yourusername/amoapi.git
cd amoapi
```

2. Установить зависимости:
```
pip install -r requirements.txt
```

3. Создать файл `.env` на основе `.env.example` и заполнить своими данными для доступа к AMO CRM:
```
cp .env.example .env
# Отредактировать файл .env
```

## Настройка упрощенной OAuth авторизации

Для доступа к API AMO CRM используется упрощенная OAuth авторизация:

1. Создайте интеграцию в AMO CRM:
   - Перейдите в настройки аккаунта -> Интеграции -> Создать интеграцию
   - Заполните обязательные поля
   - Сохраните интеграцию и получите `Integration ID`, `Secret Key` и `Authorization code`

2. Заполните файл `.env`:
   - `AMO_DOMAIN` - домен вашего аккаунта AMO CRM (например, mycompany.amocrm.ru)
   - `CLIENT_ID` - ID вашей интеграции (Integration ID)
   - `CLIENT_SECRET` - секретный ключ интеграции (Secret Key)
   - `AUTH_CODE` - полученный код авторизации (Authorization code)
   - `ACCESS_TOKEN_FILE` - путь к файлу для хранения токенов (по умолчанию "access_token.json")

## Использование

### Экспорт контактов

Для экспорта контактов из AMO CRM в CSV файл:

```
python main.py export -o contacts.csv
```

Опции:
- `-o`, `--output` - путь к файлу для сохранения контактов

### Обновление контактов

Для обновления имени и фамилии контактов в AMO CRM из CSV файла:

```
python main.py update -i updated_contacts.csv
```

Опции:
- `-i`, `--input` - путь к CSV файлу с данными для обновления контактов

### Формат CSV файла для обновления

CSV файл должен содержать следующие столбцы с разделителем `;`:

```
contact_id;new_name
36725763;Богоявленская Татьяна
```

Где:
- `contact_id` - идентификатор контакта в AMO CRM
- `new_name` - новое полное имя контакта (будет разделено на имя и фамилию автоматически)

## Обработка токенов

Программа автоматически сохраняет полученные токены в файл и использует их при последующих запусках. Если токены истекают, программа автоматически выполняет их обновление с использованием refresh_token.

## Обработка ошибок

Программа выводит информацию о ходе выполнения и возникающих ошибках в консоль. В случае ошибок при обновлении контактов, выводится список ID контактов, которые не удалось обновить.

## Лицензия

MIT